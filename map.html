<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>ã‚¤ã‚±ãƒ«ã‚«ãƒ ç›®çš„åœ°è¨­å®š</title>
    <link rel="stylesheet" href="./css/style.css">
    <style>
        html {
            background-color: skyblue;
            position: relative;
            min-height: 100vh;
        }
        
        body {
            min-height: 100vh;
            padding-bottom: 20px;
        }
        
        .map-container {
            position: relative;
            width: 100%;
            height: 400px;
            margin-bottom: 30px;
        }
        
        .event-info {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .event-info h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        
        .event-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .event-label {
            font-weight: bold;
            color: #666;
        }
        
        .event-value {
            color: #333;
        }
        
        .help-tab {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1000;
            background: #4CAF50;
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }
        
        .help-tab:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .help-tooltip {
            position: absolute;
            top: 50px;
            left: 10px;
            z-index: 1001;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            width: 300px;
            font-size: 14px;
            line-height: 1.4;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .search-container {
            position: absolute;
            top: 50px;
            left: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        #searchBox {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
        }
        
        #searchBox:focus {
            border-color: #4CAF50;
        }
        
        #searchBtn {
            padding: 10px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        #searchBtn:hover {
            background: #45a049;
        }
        
        .help-tooltip.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .help-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(0, 0, 0, 0.9);
        }
        
        .help-tooltip h4 {
            margin: 0 0 10px 0;
            color: #4CAF50;
            font-size: 16px;
        }
        
        .help-tooltip p {
            margin: 8px 0;
        }
        
        .settings-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .money-setting {
            margin-bottom: 25px;
        }
        
        .money-setting label {
            display: block;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .money-setting input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }
        
        .money-setting input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .send-button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 15px 24px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
            margin-top: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            /* style.cssã®.sendã‚¯ãƒ©ã‚¹ã®å½±éŸ¿ã‚’ä¸Šæ›¸ã */
            position: relative !important;
            height: auto !important;
            bottom: auto !important;
        }
        
        
        
        .mapclose {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .mapclose a {
            text-decoration: none;
            color: #333;
            font-size: 20px;
            font-weight: bold;
        }
    </style>
</head>

<body onload="init(); displayEventInfo();">

    <div class="map-container">
        <p class="mapclose"><a href="calendar.html">Ã—</a></p>
        <div class="help-tab" id="helpTab">æ“ä½œæ‰‹é †</div>
        <div class="help-tooltip" id="helpTooltip">
            <h4>ğŸ—ºï¸ ç›®çš„åœ°è¨­å®šã®æ‰‹é †</h4>
            <p>1. æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã§å ´æ‰€ã‚’æ¤œç´¢ã™ã‚‹ã‹ã€åœ°å›³ä¸Šã®ç›®çš„åœ°ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒ¼ã‚«ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„</p>
            <p>2. èµ¤ã„å††ã®ç¯„å›²å†…ï¼ˆ100mä»¥å†…ï¼‰ã«åˆ°é”ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</p>
            <p>3. èª²é‡‘é¡ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼ˆæœ€ä½100å††ï¼‰</p>
            <p>4. ã€Œæ±ºå®šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é…åˆ»é˜²æ­¢ãƒã‚§ãƒƒã‚¯ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</p>
        </div>
        <div class="search-container">
            <input type="text" id="searchBox" placeholder="å ´æ‰€ã‚’æ¤œç´¢..." autocomplete="off">
            <button id="searchBtn" type="button">ğŸ”</button>
        </div>
        <div id="map"></div>
    </div>

    <!-- é¸æŠä¸­ã®äºˆå®šæƒ…å ± -->
    <div class="event-info" id="eventInfo">
        <h3>ğŸ“… é¸æŠä¸­ã®äºˆå®š</h3>
        <div class="event-details">
            <span class="event-label">äºˆå®šå:</span>
            <span class="event-value" id="eventTitle">èª­ã¿è¾¼ã¿ä¸­...</span>
        </div>
        <div class="event-details">
            <span class="event-label">æœŸæ—¥:</span>
            <span class="event-value" id="eventDate">èª­ã¿è¾¼ã¿ä¸­...</span>
        </div>
    </div>

    <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="settings-section">
        <div class="money-setting">
            <label for="setmoney">ğŸ’° èª²é‡‘é¡è¨­å®š</label>
            <input type="number" id="setmoney" name="moneynum" value="100" min="100" class="setmoney">
        </div>
        
        <!-- æ±ºå®šãƒœã‚¿ãƒ³ -->
        <button type="button" class="send-button">æ±ºå®š</button>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGIYP3GFzqnzQR7skCyMXMu5mljijKTp0&libraries=places&language=ja"></script>
    <script src="js/set.js"></script>
    <script>
        // æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…
        let autocomplete;
        let searchBox;
        let searchBtn;
        
        function initSearch() {
            searchBox = document.getElementById('searchBox');
            searchBtn = document.getElementById('searchBtn');
            
            if (!searchBox || !window.google) return;
            
            // Autocompleteæ©Ÿèƒ½ã‚’åˆæœŸåŒ–
            autocomplete = new google.maps.places.Autocomplete(searchBox, {
                types: ['establishment', 'geocode'],
                componentRestrictions: { country: 'jp' }
            });
            
            // å ´æ‰€ãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†
            autocomplete.addListener('place_changed', function() {
                const place = autocomplete.getPlace();
                if (!place.geometry) {
                    alert('å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // ãƒãƒƒãƒ—ã¨ãƒãƒ¼ã‚«ãƒ¼ã‚’æ›´æ–°
                if (window.marker && window.map) {
                    const position = {
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng()
                    };
                    
                    window.lat = position.lat;
                    window.lng = position.lng;
                    
                    window.marker.setPosition(position);
                    window.circle.setCenter(position);
                    
                    // åœ°å›³ã®ä¸­å¿ƒã‚’ç§»å‹•
                    window.map.setCenter(position);
                    window.map.setZoom(17);
                    
                    // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªã‚¢
                    searchBox.value = '';
                }
            });
            
            // æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    const query = searchBox.value.trim();
                    if (!query) return;
                    
                    // Geocoding APIã§æ¤œç´¢
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ address: query + ', æ—¥æœ¬' }, function(results, status) {
                        if (status === 'OK' && results[0]) {
                            const position = {
                                lat: results[0].geometry.location.lat(),
                                lng: results[0].geometry.location.lng()
                            };
                            
                            if (window.marker && window.map) {
                                window.lat = position.lat;
                                window.lng = position.lng;
                                
                                window.marker.setPosition(position);
                                window.circle.setCenter(position);
                                
                                window.map.setCenter(position);
                                window.map.setZoom(17);
                                
                                searchBox.value = '';
                            }
                        } else {
                            alert('å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚');
                        }
                    });
                });
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ¤œç´¢æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
        window.addEventListener('load', function() {
            setTimeout(initSearch, 1000); // åœ°å›³ã®åˆæœŸåŒ–å¾Œã«å®Ÿè¡Œ
        });
    </script>
</body>
</html>
