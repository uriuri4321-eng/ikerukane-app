<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    <title>ã‚¤ã‚±ãƒ«ã‚«ãƒ ç›®çš„åœ°è¨­å®š</title>
    <link rel="stylesheet" href="./css/style.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js?v=20250219"></script>
    <style>
        /* CSSå¤‰æ•°ã®å®šç¾©ï¼ˆstyle.cssã‹ã‚‰ï¼‰ */
        :root {
            --primary-color: #4CAF50;
            --primary-dark: #45a049;
            --primary-light: #81C784;
            --danger-color: #dc3545;
            --danger-dark: #c82333;
            --bg-gradient-start: #667eea;
            --bg-gradient-end: #764ba2;
            --bg-white: #ffffff;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
            --shadow-xl: 0 12px 32px rgba(0,0,0,0.25);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --radius-xl: 25px;
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
        }
        
        html {
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            background-attachment: fixed;
            position: relative;
            min-height: 100vh;
            height: 100%;
            height: -webkit-fill-available;
        }
        
        /* style.cssã®bodyã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®Œå…¨ã«ä¸Šæ›¸ã */
        body.map-page {
            width: 100% !important;
            max-width: 100% !important;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            margin: 0 !important;
            margin-left: 0 !important;
            transform: none !important;
            background: transparent !important;
            background-color: transparent !important;
            padding: 16px !important;
            padding-top: calc(env(safe-area-inset-top) + 16px) !important;
            padding-bottom: calc(env(safe-area-inset-bottom) + 20px) !important;
            padding-left: 16px !important;
            padding-right: 16px !important;
            box-sizing: border-box !important;
            position: relative !important;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        html body.map-page {
            background: transparent !important;
        }
        
        /* å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆstyle.cssã‹ã‚‰å¿…è¦ãªéƒ¨åˆ†ã®ã¿ï¼‰ */
        * {
            -webkit-overflow-scrolling: touch;
        }
        
        a, button {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }
        
        button {
            -webkit-appearance: none;
            appearance: none;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="datetime-local"],
        input[type="date"],
        input[type="time"],
        textarea,
        select {
            font-size: 16px !important;
            -webkit-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }
        
        .map-container {
            position: relative;
            width: 100%;
            height: 60vh;
            min-height: 500px;
            margin-bottom: 30px;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }
        
        @media (min-height: 800px) {
            .map-container {
                height: 70vh;
                min-height: 600px;
            }
        }
        
        .event-info {
            background: var(--bg-white);
            padding: 24px;
            border-radius: var(--radius-md);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        .event-info h3 {
            margin-top: 0;
            color: var(--text-primary);
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 12px;
            font-weight: 700;
            font-size: 20px;
        }
        
        .event-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .event-label {
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .event-value {
            color: var(--text-primary);
            font-weight: 500;
        }
        
        .help-tab {
            position: absolute;
            top: 12px;
            left: 12px;
            z-index: 1000;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 10px 16px;
            border-radius: var(--radius-xl);
            cursor: pointer;
            font-size: 13px;
            font-weight: 700;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
        }
        
        .help-tab:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }
        
        .help-tooltip {
            position: absolute;
            top: 55px;
            left: 12px;
            z-index: 1001;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(8px);
            color: white;
            padding: 20px;
            border-radius: var(--radius-md);
            width: 300px;
            font-size: 14px;
            line-height: 1.6;
            box-shadow: var(--shadow-xl);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all var(--transition-normal);
            pointer-events: none;
        }
        
        .search-container {
            position: absolute;
            top: 50px;
            left: 12px;
            right: 12px;
            z-index: 1000;
            display: flex;
            gap: 8px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(8px);
            padding: 10px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
        }
        
        #searchBox {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: 14px;
            outline: none;
            transition: all var(--transition-fast);
        }
        
        #searchBox:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        #searchBtn {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-sm);
        }
        
        #searchBtn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .help-tooltip.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .help-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(0, 0, 0, 0.95);
        }
        
        .help-tooltip h4 {
            margin: 0 0 12px 0;
            color: var(--primary-light);
            font-size: 16px;
            font-weight: 700;
        }
        
        .help-tooltip p {
            margin: 10px 0;
        }
        
        .settings-section {
            background: var(--bg-white);
            padding: 28px;
            border-radius: var(--radius-md);
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        .money-setting {
            margin-bottom: 28px;
        }
        
        .money-setting label {
            display: block;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .money-setting input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 16px;
            box-sizing: border-box;
            transition: all var(--transition-fast);
        }
        
        .money-setting input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: var(--radius-xl);
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            transition: all var(--transition-normal);
            margin-top: 20px;
            display: block;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            position: relative !important;
            height: auto !important;
            bottom: auto !important;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }
        
        .send-button:active {
            transform: translateY(0);
        }
        
        .mapclose {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            transition: all var(--transition-fast);
        }
        
        .mapclose:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.1);
        }
        
        .mapclose a {
            text-decoration: none;
            color: var(--danger-color);
            font-size: 24px;
            font-weight: bold;
            transition: all var(--transition-fast);
        }
        
        .mapclose a:hover {
            color: var(--danger-dark);
        }
    </style>
</head>

<body class="map-page" onload="init(); displayEventInfo();">

    <div class="map-container">
        <p class="mapclose"><a href="calendar.html">Ã—</a></p>
        <div class="help-tab" id="helpTab">æ“ä½œæ‰‹é †</div>
        <div class="help-tooltip" id="helpTooltip">
            <h4>ğŸ—ºï¸ ç›®çš„åœ°è¨­å®šã®æ‰‹é †</h4>
            <p>1. æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã§å ´æ‰€ã‚’æ¤œç´¢ã™ã‚‹ã‹ã€åœ°å›³ä¸Šã®ç›®çš„åœ°ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒãƒ¼ã‚«ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„</p>
            <p>2. èµ¤ã„å††ã®ç¯„å›²å†…ï¼ˆ100mä»¥å†…ï¼‰ã«åˆ°é”ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™</p>
            <p>3. èª²é‡‘é¡ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼ˆæœ€ä½100å††ï¼‰</p>
            <p>4. ã€Œæ±ºå®šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é…åˆ»é˜²æ­¢ãƒã‚§ãƒƒã‚¯ã‚’é–‹å§‹ã—ã¦ãã ã•ã„</p>
        </div>
        <div class="search-container">
            <input type="text" id="searchBox" placeholder="å ´æ‰€ã‚’æ¤œç´¢..." autocomplete="off">
            <button id="searchBtn" type="button">ğŸ”</button>
        </div>
        <div id="map"></div>
    </div>

    <!-- é¸æŠä¸­ã®äºˆå®šæƒ…å ± -->
    <div class="event-info" id="eventInfo">
        <h3>ğŸ“… é¸æŠä¸­ã®äºˆå®š</h3>
        <div class="event-details">
            <span class="event-label">äºˆå®šå:</span>
            <span class="event-value" id="eventTitle">èª­ã¿è¾¼ã¿ä¸­...</span>
        </div>
        <div class="event-details">
            <span class="event-label">æœŸæ—¥:</span>
            <span class="event-value" id="eventDate">èª­ã¿è¾¼ã¿ä¸­...</span>
        </div>
    </div>

    <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="settings-section">
        <div class="money-setting">
            <label for="setmoney">ğŸ’° èª²é‡‘é¡è¨­å®š</label>
            <input type="number" id="setmoney" name="moneynum" value="100" min="100" class="setmoney">
        </div>
        
        <!-- æ±ºå®šãƒœã‚¿ãƒ³ -->
        <button type="button" class="send-button">æ±ºå®š</button>
    </div>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGIYP3GFzqnzQR7skCyMXMu5mljijKTp0&libraries=places&language=ja"></script>
    <script src="js/set.js?v=20250219"></script>
    <script>
        // æ¤œç´¢æ©Ÿèƒ½ã®å®Ÿè£…
        let autocomplete;
        let searchBox;
        let searchBtn;
        
        function initSearch() {
            searchBox = document.getElementById('searchBox');
            searchBtn = document.getElementById('searchBtn');
            
            if (!searchBox || !window.google) return;
            
            // Autocompleteæ©Ÿèƒ½ã‚’åˆæœŸåŒ–
            autocomplete = new google.maps.places.Autocomplete(searchBox, {
                types: ['establishment', 'geocode'],
                componentRestrictions: { country: 'jp' }
            });
            
            // å ´æ‰€ãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†
            autocomplete.addListener('place_changed', function() {
                const place = autocomplete.getPlace();
                if (!place.geometry) {
                    alert('å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }
                
                // ãƒãƒƒãƒ—ã¨ãƒãƒ¼ã‚«ãƒ¼ã‚’æ›´æ–°
                if (window.marker && window.map) {
                    const position = {
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng()
                    };
                    
                    window.lat = position.lat;
                    window.lng = position.lng;
                    
                    window.marker.setPosition(position);
                    window.circle.setCenter(position);
                    
                    // åœ°å›³ã®ä¸­å¿ƒã‚’ç§»å‹•
                    window.map.setCenter(position);
                    window.map.setZoom(17);
                    
                    // æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªã‚¢
                    searchBox.value = '';
                }
            });
            
            // æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    const query = searchBox.value.trim();
                    if (!query) return;
                    
                    // Geocoding APIã§æ¤œç´¢
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ address: query + ', æ—¥æœ¬' }, function(results, status) {
                        if (status === 'OK' && results[0]) {
                            const position = {
                                lat: results[0].geometry.location.lat(),
                                lng: results[0].geometry.location.lng()
                            };
                            
                            if (window.marker && window.map) {
                                window.lat = position.lat;
                                window.lng = position.lng;
                                
                                window.marker.setPosition(position);
                                window.circle.setCenter(position);
                                
                                window.map.setCenter(position);
                                window.map.setZoom(17);
                                
                                searchBox.value = '';
                            }
                        } else {
                            alert('å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚åˆ¥ã®ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚');
                        }
                    });
                });
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ¤œç´¢æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
        window.addEventListener('load', function() {
            setTimeout(initSearch, 1000); // åœ°å›³ã®åˆæœŸåŒ–å¾Œã«å®Ÿè¡Œ
        });
    </script>
</body>
</html>
